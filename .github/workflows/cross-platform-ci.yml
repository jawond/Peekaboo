name: Cross-Platform CI

on:
  push:
    branches: [ main, codegen-bot/* ]
  pull_request:
    branches: [ main ]

jobs:
  test-macos:
    runs-on: macos-latest
    env:
      DEVELOPER_DIR: /Applications/Xcode_16.3.app/Contents/Developer
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Xcode
      run: |
        sudo xcode-select -s $DEVELOPER_DIR
        xcodebuild -version
        swift --version
    
    - name: Build for macOS
      run: |
        cd peekaboo-cli
        swift build -c release
    
    - name: Test CLI functionality
      run: |
        cd peekaboo-cli
        swift run peekaboo --help

  test-linux:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Install Swift
      uses: swift-actions/setup-swift@v2
      with:
        swift-version: "6.0"
    
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libx11-dev libxrandr-dev libxinerama-dev
    
    - name: Build for Linux
      run: |
        cd peekaboo-cli
        swift build -c release
    
    - name: Test CLI functionality
      run: |
        cd peekaboo-cli
        swift run peekaboo --help

  test-windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Install Swift
      uses: compnerd/gha-setup-swift@main
      with:
        branch: swift-6.0-release
        tag: 6.0-RELEASE
    
    - name: Build for Windows
      shell: cmd
      run: |
        cd peekaboo-cli
        swift build -c release
    
    - name: Test CLI functionality
      shell: cmd
      run: |
        cd peekaboo-cli
        swift run peekaboo --help

